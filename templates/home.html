{% load static %}
<!DOCTYPE html>
<html lang="jp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markov-Chain</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="icon" href="{% static 'favicon.png' %}" type="image/png">

    <style>
        body {
    padding: 50px 5vw;
}

.header {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap; /* Smaller screens should allow wrapping */
}

h1 {
    margin: 0.3rem 0;
    font-size: 4rem;
    font-family: garamond, serif;
    font-weight: bold;
}

.today {
    display: flex;
    align-items: center;
    text-align: right;
    font-size: 1rem;
    line-height: 2rem;
    letter-spacing: 0.14rem;
}

hr {
    margin: 3px 0;
}

.information {
    margin-top: 2vh;
    margin-bottom: 2vh;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px; /* Add gap for better spacing */
    line-height: 1.5em;
}

.japanese {
    margin-right: 1em;
    color: #808080;
    line-height: 1.5rem;
    letter-spacing: 0.14rem;
}

.english {
    margin-left: 1rem;
    color: #808080;
    line-height: 1.7rem;
    letter-spacing: 0.14rem;
}

.ruby {
    margin-top: 4vh;
    margin-bottom: 0;
    font-family: "Inter", sans-serif;
    font-weight: bold;
}

h2 {
    margin-top: 0;
    margin-bottom: 1rem;
    font-size: 2.5rem;
    font-weight: bold;
}

textarea,
.result {
    resize: none;
    width: calc(100% - 30px);
    height: 40vh;
    padding: 15px;
    font-family: monospace, sans-serif;
    font-size: 0.8rem;
    line-height: 2rem;
    letter-spacing: 0.14rem;

    border: #808080 1px solid;
    border-radius: 15px;
}

.supplement {
    font-family: Inter, sans-serif;
    font-size: 0.8rem;
}

.button-container {
    display: flex;
    gap: 20px;
    justify-content: left;
    flex-wrap: wrap; /* Allow buttons to wrap on smaller screens */
}

button {
    width: 180px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    font-size: 1.2em;
    font-family: "Inter Semi Bold", sans-serif;
    background-color: #fff;
    border: #808080 1px solid;
    border-radius: 15px;
    padding: 0 10px;
    cursor: pointer;
    transition: all 0.3s ease;
}

button:hover {
    background-color: #252525;
    color: #fff;
    transform: translateY(-2px);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

button:active {
    background-color: #000000;
    color: #fff;
    transform: translateY(0);
    box-shadow: none;
}

img {
    width: 30px;
    height: 30px;
    display: block;
    filter: invert(0);
    transition: filter 0.3s ease;
}

button:hover img, button:active img {
    filter: invert(1);
}

.footer {
    margin-top: 10vh;
}

/* Media Queries for Responsive Design */

@media (max-width: 1200px) {
    .information {
        grid-template-columns: 1fr; /* Stack columns on smaller screens */
    }

    h1 {
        font-size: 3rem; /* Reduce size for smaller screens */
    }

    .today {
        font-size: 0.8rem;
        line-height: 1.5rem;
    letter-spacing: 0.14rem;
    }
}

@media (max-width: 768px) {
    .header {
        flex-direction: column; /* Stack header items vertically */
        align-items: center; /* Center them */
    }

    .today {
        text-align: center; /* Center align for smaller screens */
    }

    button {
        width: 100%; /* Full width for buttons */
    }
}

@media (max-width: 576px) {
    body {
        padding: 20px 3vw; /* Reduce padding for very small screens */
    }

    h1 {
        font-size: 2.5rem; /* Further reduce size */
    }

    .button-container {
        flex-direction: column; /* Stack buttons vertically */
        gap: 10px; /* Reduce gap for small screens */
    }
}

    </style>
</head>
<body>
    <div class="header">
        <h1>Markov-Chain</h1>
        <div class="today">
            <p>Sunday, September 1, 2024<br>
                Created by Yuta Morikawa</p>
        </div>
    </div>
    <hr>
    <hr>
    <div class="information">
        <p class="japanese">
            このシステムでは、マルコフ連鎖をつかって、現在の状態から次の状態への遷移を確率的に決定することで、現実的なテキストの変化をシミュレーションします。Yahoo APIを用いて日本語の文章を形態素解析し、各単語ごとの遷移確率を計算し、モデルを構築します。このモデルを活用し、ランダムな名詞から始まる文章を自動生成することができます。
            ただし、マルコフ連鎖は理論的に無限に続く可能性があるため、このシステムでは100単語以内の文章が生成されるように設定されています。また、Yahoo APIの制約上、一度に複数回リクエストすると使用できなくなる可能性があります。そのため、一度生成されたモデルは再利用し、「続けて生成」機能を利用することで、効率的に新しい文章を生成できます。
        </p>
        <p class="english">
            This system uses Markov chains to probabilistically generate text transitions, creating realistic Japanese sentences. It employs the Yahoo API for morphological analysis, calculates word transition probabilities, and constructs a model to generate sentences starting with random nouns. To avoid infinite generation, sentences are limited to 100 words. Due to Yahoo API limitations, the model can be reused for efficient generation with a "continue generating" feature.
        </p>
    </div>
    <hr>
    <div class="generator">
        <p class="ruby">The source text for generation</p>
        <h2>生成元のテキスト</h2>
         <form id="markovForm" method="post">
            {% csrf_token %}
            <textarea name="text_input" placeholder="テキストを入力"></textarea>
            <div class="button-container">
                <button type="button" id="generateNew">
                    <img src="{% static 'generate.png' %}" alt="生成するアイコン">
                    生成する
                </button>
                <button type="button" id="useExisting">
                    <img src="{% static 'repeat.png' %}" alt="続けて生成アイコン">
                    続けて生成
                </button>
            </div>
        </form>
        <p class="supplement">かならず一度生成したら元のテキストを変更しない限り、続けて生成を押してください</p>

        <p class="ruby">After writing</p>
        <h2>執筆後</h2>
        <div class="result" id="result"></div><!-- 解析結果を表示するためのエリア -->
    </div>

    <div class="footer">
        <p></p>
        <span style="margin:15px 15px 15px 15px"><a href="https://developer.yahoo.co.jp/sitemap/">Webサービス by Yahoo! JAPAN</a></span>
    </div>


    <script>
        $(document).ready(function () {
            // 新しいモデルを生成ボタンがクリックされた場合
            $('#generateNew').on('click', function (e) {
                e.preventDefault();  // フォームのデフォルトの送信をキャンセル

                $.ajax({
                    type: 'POST',
                    url: '',  // 現在のURLに送信
                    data: $('#markovForm').serialize() + '&action=generateNew',  // アクションを追加して送信
                    success: function (response) {
                        $('#result').html(response);  // 成功時に結果を表示エリアに挿入
                    },
                    error: function (xhr, status, error) {
                        $('#result').html("エラーが発生しました。");  // エラー時の処理
                    }
                });
            });

            // 既存のモデルを使用ボタンがクリックされた場合
            $('#useExisting').on('click', function (e) {
                e.preventDefault();  // フォームのデフォルトの送信をキャンセル

                $.ajax({
                    type: 'POST',
                    url: '',  // 現在のURLに送信
                    data: $('#markovForm').serialize() + '&action=useExisting',  // アクションを追加して送信
                    success: function (response) {
                        $('#result').html(response);  // 成功時に結果を表示エリアに挿入
                    },
                    error: function (xhr, status, error) {
                        $('#result').html("エラーが発生しました。");  // エラー時の処理
                    }
                });
            });
        });
    </script>
</body>
</html>
